@model List<TESTER.Models.Event>
@{
    ViewBag.Title = "Events & Announcements";
    var recommended = ViewBag.Recommended as List<TESTER.Models.Event> ?? new();
    var recent = ViewBag.Recent as List<TESTER.Models.Event> ?? new();
    var curSearch = ViewBag.CurrentSearch as string ?? "";
    var curStart = ViewBag.CurrentStartDate as string ?? "";
    var curEnd = ViewBag.CurrentEndDate as string ?? "";
}

<div class="container py-5" style="max-width: 960px;">
    <!-- Header -->
    <div class="text-center mb-5">
        <h2 class="fw-bold mb-1">Events & Announcements</h2>
        <p class="text-muted small mb-0">Stay updated with community events and important news.</p>
    </div>

    <!-- category filter and date filter-->
    <div class="card shadow-sm mb-5">
        <div class="card-body p-4">
            <form method="get" action="@Url.Action("LocalEvents", "Home")" class="row g-3 align-items-end">

                <!-- search box -->
                <div class="col-md-5">
                    <label class="form-label small text-muted mb-1">Search</label>
                    <input type="text" name="search" value="@curSearch"
                           class="form-control form-control-sm"
                           placeholder="Title or category..." />
                </div>

                <!-- start date -->
                <div class="col-md-3">
                    <label class="form-label small text-muted mb-1">From</label>
                    <input type="date" name="startDate" value="@curStart"
                           class="form-control form-control-sm" />
                </div>

                <!--end date -->
                <div class="col-md-3">
                    <label class="form-label small text-muted mb-1">To</label>
                    <input type="date" name="endDate" value="@curEnd"
                           class="form-control form-control-sm" />
                </div>

                <!-- buttons -->
                <div class="col-md-1 d-grid gap-1">
                    <button type="submit" class="btn btn-primary btn-sm">
                        Search
                    </button>
                    <a href="@Url.Action("LocalEvents")" class="btn btn-outline-secondary btn-sm">
                        Clear
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!--recommended events -->
    @if (recommended.Any())
    {
        <section class="mb-5">
            <h6 class="fw-semibold text-success mb-3">Recommended For You</h6>
            <div class="list-group list-group-flush">
                @foreach (var e in recommended)
                {
                    <a href="@Url.Action("ViewEvent", "Home", new { id = e.Id })"
                       class="list-group-item list-group-item-action py-3 px-2 border-0 border-bottom">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <strong>@e.Title</strong>
                                <div class="text-muted small">@e.Date.ToString("MMMM dd, yyyy")</div>
                            </div>
                            <span class="badge bg-success-subtle text-success">@e.Category</span>
                        </div>
                    </a>
                }
            </div>
        </section>
    }

    <!--recently viewed-->
    @if (recent.Any())
    {
        <section class="mb-5">
            <h6 class="fw-semibold text-secondary mb-3">Recently Viewed</h6>
            <div class="d-flex flex-wrap gap-3">
                @foreach (var e in recent)
                {
                    <a href="@Url.Action("ViewEvent", "Home", new { id = e.Id })"
                       class="text-decoration-none">
                        <div class="p-2 bg-light rounded text-center" style="min-width: 110px;">
                            <div class="fw-semibold small text-dark text-truncate" style="max-width: 110px;">
                                @e.Title
                            </div>
                            <div class="text-muted xsmall">@e.Date.ToString("MMM dd")</div>
                        </div>
                    </a>
                }
            </div>
        </section>
    }

    <!--display all events -->
    <section>
        <h6 class="fw-semibold text-primary mb-3">All Events</h6>
        @if (Model?.Any() == true)
        {
            <div class="list-group list-group-flush border-top">
                @foreach (var e in Model)
                {
                    <a href="@Url.Action("ViewEvent", "Home", new { id = e.Id })"
                       class="list-group-item list-group-item-action px-2 py-3 border-0 border-bottom">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="fw-semibold">@e.Title</div>
                                <div class="text-muted small">@e.Date.ToString("MMMM dd, yyyy")</div>
                            </div>
                            <span class="badge bg-primary-subtle text-primary">@e.Category</span>
                        </div>
                    </a>
                }
            </div>
        }
        else
        {
            <div class="text-center text-muted py-5 border rounded-3 bg-light">
                No events match your search.
            </div>
        }
    </section>
</div>